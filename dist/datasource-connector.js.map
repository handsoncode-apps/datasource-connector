{"version":3,"sources":["webpack://DatasourceConector/webpack/universalModuleDefinition","webpack://DatasourceConector/webpack/bootstrap","webpack://DatasourceConector/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","hotInstance","SuperClass","Handsontable","plugins","BasePlugin","URI","constructor","this","_serialie","prefix","queryStrings","key","push","encodeURIComponent","join","string","undefined","Request","url","method","headers","body","super","controllerUrl","hot","getSettings","dataSourceConnector","isEnabled","console","log","enablePlugin","addHook","isForced","onAfterInit","changes","source","onAfterChange","column","order","onAfterColumnSort","index","amount","onAfterCreateRow","onAfterCreateCol","columns","target","onAfterColumnMove","conditionsStack","onAfterFilter","queryArr","length","operator","getPlugin","conditionCollection","columnTypes","j","conditions","args","colHeaders","k","tempOperator","operatorWithVariable","query","colMoved","_post","payload","then","uri","_get","response","_loadData","reponse","responseData","data","normalizedData","row","item","columnName","loadData","columnNames","setCellMeta","rowId","updateSettings","disablePlugin","updatePlugin","changeItems","cellMeta","getCellMeta","row_id","col_id","oldValue","newValue","meta","destroy","onDataSend","onData","request","_request","reqest","JSSON","parse","obj","Promise","resolve","reject","xhr","XMLHttpRequest","open","keys","forEach","setRequestHeader","onload","status","statusText","onerror","send"],"mappings":"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","file":"datasource-connector.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"DatasourceConector\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DatasourceConector\"] = factory();\n\telse\n\t\troot[\"DatasourceConector\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const DataSourceConnector = (hotInstance) => {\r\n  let SuperClass = Handsontable.plugins.BasePlugin\r\n  /**\r\n   * @plugin InternalPluginSkeleton\r\n   * Note: keep in mind, that Handsontable instance creates one instance of the plugin class.\r\n   *\r\n   * @description\r\n   * Blank plugin template. It needs to inherit from the BasePlugin class.\r\n   */\r\n  class DataSourceConnectorPlugin extends SuperClass {\r\n\r\n    // The argument passed to the constructor is the currently processed Handsontable instance object.\r\n    constructor(hotInstance) {\r\n      super(hotInstance)\r\n      this.controllerUrl = this.hot.getSettings().dataSourceConnector.controllerUrl;\r\n    }\r\n\r\n    /**\r\n     * Checks if the plugin is enabled in the settings.\r\n     */\r\n    isEnabled() {\r\n      console.log(\"enabled:\", !!this.hot.getSettings().dataSourceConnector)\r\n      return !!this.hot.getSettings().dataSourceConnector;\r\n    }\r\n\r\n    /**\r\n     * The enablePlugin method is triggered on the beforeInit hook. It should contain your initial plugin setup, along with\r\n     * the hook connections.\r\n     * Note, that this method is run only if the statement in the isEnabled method is true.\r\n     */\r\n    enablePlugin() {\r\n\r\n\r\n      // disable build in sort and filter functions\r\n      this.addHook('beforeColumnSort', () => { return false; });\r\n      this.addHook('beforeFilter', () => { return false; })\r\n      this.addHook('afterRender', (isForced) => { });\r\n\r\n      this.addHook('afterInit', () => this.onAfterInit());\r\n      this.addHook('afterChange', (changes, source) => this.onAfterChange(changes, source));\r\n      this.addHook('afterColumnSort', (column, order) => this.onAfterColumnSort(column, order));\r\n\r\n      this.addHook('afterCreateRow', (index, amount, source) => this.onAfterCreateRow(index, amount, source));\r\n      this.addHook('afterCreateCol', (index, amount, source) => this.onAfterCreateCol(index, amount, source));\r\n      this.addHook('afterColumnMove', (columns, target) => this.onAfterColumnMove(columns, target));\r\n      this.addHook('afterFilter', (conditionsStack) => this.onAfterFilter(conditionsStack))\r\n\r\n      // The super method assigns the this.enabled property to true, which can be later used to check if plugin is already enabled.\r\n      super.enablePlugin();\r\n    }\r\n\r\n    onAfterFilter(conditionsStack) {\r\n      let queryArr = []\r\n      if (conditionsStack.length > 0) {\r\n        for (let i = 0; i < conditionsStack.length; i++) {\r\n          operator = this.hot.getPlugin('filters').conditionCollection.columnTypes[conditionsStack[i].column]\r\n          switch (operator) {\r\n            case 'conjunction':\r\n              operator = ['and']\r\n              break;\r\n            case 'disjunction':\r\n              operator = ['or']\r\n              break;\r\n            case 'disjunctionAndVariable':\r\n              operator = ['or', 'and']\r\n              break;\r\n          }\r\n          for (let j = 0; j < conditionsStack[i].conditions.length; j++) {\r\n            if (operator[j]) {\r\n              conditionsStack[i].conditions[j].operator = operator[j]\r\n            }\r\n            if (conditionsStack[i].conditions[j].args.length != 0) {\r\n              if (typeof conditionsStack[i].conditions[j].args[0] === 'string') {\r\n                queryArr.push(\"[\" + this.colHeaders[conditionsStack[i].column] + \"][\" + conditionsStack[i].conditions[j].name + \"]=\" + conditionsStack[i].conditions[j].args[0])\r\n              } else {\r\n                for (let k = 0; k < conditionsStack[i].conditions[j].args[0].length; k++) {\r\n                  queryArr.push(\"[\" + this.colHeaders[conditionsStack[i].column] + \"][\" + conditionsStack[i].conditions[j].name + \"]=\" + conditionsStack[i].conditions[j].args[0][k])\r\n                }\r\n              }\r\n            } else {\r\n              queryArr.push(\"[\" + this.colHeaders[conditionsStack[0].column] + \"][\" + conditionsStack[i].conditions[j].name + \"]=true\")\r\n            }\r\n            if (j < conditionsStack[i].conditions.length - 1) {\r\n              tempOperator = conditionsStack[i].conditions[j].operator || 'and'\r\n              queryArr.push(\"[\" + this.colHeaders[conditionsStack[i].column] + \"][operator]=\" + tempOperator)\r\n            }\r\n          }\r\n          operatorWithVariable = false\r\n        }\r\n        var query = \"?\" + queryArr.join('&')\r\n        console.log(query)\r\n        // this._get(controllerUrl + '/data' + query).then(response => {\r\n        //   this._loadData(response)\r\n        // })\r\n      }\r\n    }\r\n\r\n    onAfterColumnMove(columns, target) {\r\n      var colMoved = {\r\n        columns: columns,\r\n        target: target\r\n      };\r\n      this._post(this.controllerUrl + '/aftercolumnmove', colMoved);\r\n    }\r\n\r\n    onAfterCreateCol(index, amount, source) {\r\n      var payload = {\r\n        index: index,\r\n        amount: amount,\r\n        source: source\r\n      };\r\n      this._post(this.controllerUrl + '/aftercreatecol', payload).then(value => {\r\n        // TODO: setup meta for new created row\r\n        return value;\r\n      });\r\n    }\r\n\r\n    onAfterCreateRow(index, amount, source) {\r\n      var payload = {\r\n        index: index,\r\n        amount: amount,\r\n        source: source\r\n      };\r\n      this._post(this.controllerUrl + '/aftercreaterow', payload).then(value => {\r\n        // TODO: setup meta for new created row\r\n        return value;\r\n      });\r\n    }\r\n\r\n    onAfterColumnSort(column, order) {\r\n      let uri = new URI({ column: this.colHeaders[column], order: order });\r\n      this._get(controllerUrl + \"/aftercolumnsort\" + uri.string())\r\n        .then(response => {\r\n          this._loadData(reponse)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Load data and setup all dedicated metadata for backend sync\r\n     * @param {object} response \r\n     */\r\n    _loadData(response) {\r\n      let responseData = response.data\r\n      let normalizedData = []\r\n      for (let row = 0; row < responseData.length; row++) {\r\n        let item = []\r\n        for (let columnName in responseData[row]) {\r\n          item.push(responseData[row][columnName])\r\n        }\r\n        normalizedData.push(item)\r\n      }\r\n\r\n      this.hot.loadData(normalizedData);\r\n\r\n      let columnNames = []\r\n      for (let columnName in responseData[0]) {\r\n        columnNames.push(columnName)\r\n      }\r\n      for (let row = 0; row < responseData.length; row++) {\r\n        for (let column = 0; column < columnNames.length; column++) {\r\n          this.hot.setCellMeta(row, column, \"row_id\", responseData[row][response.rowId]);\r\n          this.hot.setCellMeta(row, column, \"col_id\", columnNames[column]);\r\n        }\r\n      }\r\n    }\r\n\r\n    onAfterInit() {\r\n      console.log('after init')\r\n      this._get(this.controllerUrl + '/settings')\r\n        .then(response => {\r\n          this.hot.updateSettings(response.data)\r\n        })\r\n      this._get(this.controllerUrl + '/data')\r\n        .then(response => {\r\n          this._loadData(response)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * The disablePlugin method is used to disable the plugin. Reset all of your classes properties to their default values here.\r\n     */\r\n    disablePlugin() {\r\n      // The super method takes care of clearing the hook connections and assigning the 'false' value to the 'this.enabled' property.\r\n      super.disablePlugin();\r\n    }\r\n\r\n    /**\r\n     * The updatePlugin method is called on the afterUpdateSettings hook (unless the updateSettings method turned the plugin off).\r\n     * It should contain all the stuff your plugin needs to do to work properly after the Handsontable instance settings were modified.\r\n     */\r\n    updatePlugin() {\r\n\r\n      // The updatePlugin method needs to contain all the code needed to properly re-enable the plugin. In most cases simply disabling and enabling the plugin should do the trick.\r\n      this.disablePlugin();\r\n      this.enablePlugin();\r\n\r\n      super.updatePlugin();\r\n    }\r\n\r\n    /**\r\n     * The afterChange hook callback.\r\n     *\r\n     * @param {Array} changes Array of changes.\r\n     * @param {String} source Describes the source of the change.\r\n     */\r\n    onAfterChange(changes, source) {\r\n      if (changes) {\r\n        let changeItems = [];\r\n        for (let i = 0; i < changes.length; i++) {\r\n          let cellMeta = this.hot.getCellMeta(changes[i][0], changes[i][1])\r\n          let item = {\r\n            row: cellMeta.row_id,\r\n            column: cellMeta.col_id,\r\n            oldValue: changes[i][2],\r\n            newValue: changes[i][3],\r\n            meta: cellMeta\r\n          };\r\n          delete item.meta[\"instance\"];\r\n          changeItems.push(item);\r\n        }\r\n        this._post(this.controllerUrl + '/afterchange', {\r\n          changes: changeItems,\r\n          source: source\r\n        })\r\n      }\r\n    }\r\n\r\n    /**\r\n     * The destroy method should de-assign all of your properties.\r\n     */\r\n    destroy() {\r\n      // The super method takes care of de-assigning the event callbacks, plugin hooks and clearing all the plugin properties.\r\n      super.destroy();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Object} any data send to  \r\n     */\r\n    onDataSend(value) {\r\n      let onData = this.hot.getSettings().dataSourceConnector.onDataSend;\r\n      if (typeof onData === 'function') {\r\n        onData(value)\r\n      }\r\n    }\r\n\r\n    /**\r\n     * make HTTP POST to url with payload data\r\n     * \r\n     * @param {string} url \r\n     * @param {any} data \r\n     */\r\n    _post(url, data) {\r\n\r\n      let request = new Request();\r\n      request.url = url;\r\n      request.method = 'POST';\r\n      request.body = data;\r\n      request.headers = ['application/json'];\r\n\r\n      return this._request(request).then(\r\n        value => {\r\n          this.onDataSend({ reqest: request, response: JSSON.parse(value) });\r\n          return value;\r\n        }\r\n      )\r\n    }\r\n\r\n    /**\r\n     * make HTTP GET call on url\r\n     * \r\n     * @param {string} url \r\n     */\r\n    _get(url) {\r\n\r\n      var request = new Request();\r\n      request.url = url;\r\n      request.headers = ['application/json'];\r\n\r\n      return this._request(request).then(\r\n        value => {\r\n          this.onDataSend({ reqest: request, response: JSSON.parse(value) });\r\n          return value;\r\n        }\r\n      )\r\n    }\r\n\r\n    /**\r\n     * Send the xhr request to server \r\n     * \r\n     * @param {Reqest} obj Request object\r\n     * @returns {Promise}\r\n     */\r\n    _request(obj) {\r\n      return new Promise((resolve, reject) => {\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.open(obj.method || \"GET\", obj.url);\r\n        if (obj.headers) {\r\n          Object.keys(obj.headers).forEach(key => {\r\n            xhr.setRequestHeader(key, obj.headers[key]);\r\n          });\r\n        }\r\n        xhr.onload = () => {\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            resolve(xhr.response);\r\n          } else {\r\n            reject(xhr.statusText);\r\n          }\r\n        };\r\n        xhr.onerror = () => reject(xhr.statusText);\r\n        xhr.send(obj.body);\r\n      });\r\n    };\r\n  }\r\n\r\n  class URI {\r\n    constructor(object) {\r\n      this.object = object;\r\n    }\r\n\r\n    _serialie(object, prefix) {\r\n      let queryStrings = [], property;\r\n      for (property in object) {\r\n        if (object.hasOwnProperty(property)) {\r\n          let key = prefix ? prefix + '[' + property + ']' : property;\r\n          let value = object[property];\r\n          queryStrings.push((value !== null && typeof value === 'object') ? this._serialie(value, key) : encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n      }\r\n      return queryStrings.join('&');\r\n    }\r\n\r\n    string() {\r\n      if (this.object === undefined) {\r\n        return '';\r\n      }\r\n      return '?' + this._serialie(this.object)\r\n    }\r\n  }\r\n\r\n  class Request {\r\n    constructor() {\r\n      this.url = '';\r\n      this.method = 'GET';\r\n      this.headers = [];\r\n      this.body = {};\r\n    }\r\n  }\r\n\r\n  return new DataSourceConnectorPlugin(hotInstance);\r\n}\r\n\r\n\r\n\r\n// registerPlugin('dataSourceConnectorPlugin', DataSourceConnectorPlugin);\r\n\r\n\r\n// You need to register your plugin in order to use it within Handsontable.\r\n// const instance = new DataSourceConnector({SuperClass:Handsontable.plugins.BasePlugin, hotInstance: hotInstance})\r\n\r\nexport default DataSourceConnector;"],"sourceRoot":""}