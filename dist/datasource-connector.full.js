/*!
 * 
 * Version: 1.0.0
 * Release date: 01/03/2018 (built at 25/04/2018 13:48:33)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Handsontable")):"function"==typeof define&&define.amd?define("DatasourceConector",["Handsontable"],e):"object"==typeof exports?exports.DatasourceConector=e(require("Handsontable")):t.DatasourceConector=e(t.Handsontable)}(window,function(t){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(r,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=a(o(1)),l=a(o(5)),c=function(t){function e(e){var o=t.call(this,e)||this;return o.hotInstance=e,o.hot=e,o.colHeaders=[],o.filters=[],o.sort={},o.http=new u.default("/"),o}return r(e,t),e.prototype.isEnabled=function(){var t=!!this.hotInstance.getSettings().dataSourceConnector;if(t){var e=this.hotInstance.getSettings().dataSourceConnector.controllerUrl;void 0!==this.hotInstance.getSettings().dataSourceConnector.onDataSend&&this.hotInstance.addHook("onDataSend",this.hotInstance.getSettings().dataSourceConnector.onDataSend),this.http=new u.default(e),this.http.defaultHeaders=this.hotInstance.getSettings().dataSourceConnector.requestHeaders;this.hot;var o=this;this.http.addListener(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];void 0!==o.hotInstance&&o.hotInstance.runHooks("onDataSend",t[0])})}return t},e.prototype.enablePlugin=function(){var e=this;this.addHook("beforeColumnSort",function(){return!1}),this.addHook("beforeFilter",function(){return!1}),this.addHook("beforeRemoveCol",function(t,o){return e.onRemoveCol(t,o)}),this.addHook("beforeRemoveRow",function(t,o){return e.onRemoveRow(t,o)}),this.addHook("afterInit",function(){return e.onAfterInit()}),this.addHook("afterChange",function(t,o){return e.onAfterChange(t,o)}),this.addHook("afterColumnSort",function(t,o){return e.onAfterColumnSort(t,o)}),this.addHook("afterCreateRow",function(t,o,n){return e.onAfterCreateRow(t,o,n)}),this.addHook("afterCreateCol",function(t,o,n){return e.onAfterCreateCol(t,o,n)}),this.addHook("afterColumnMove",function(t,o){return e.onAfterColumnMove(t,o)}),this.addHook("afterFilter",function(t){return e.onAfterFilter(t)}),this.addHook("beforeRowMove",function(t,o){return e.onRowMove(t,o)}),this.addHook("afterRowResize",function(t,o,n){return e.onRowResize(t,o)}),this.addHook("afterMergeCells",function(t,o,n){return e.onMergeCell(t,o)}),this.addHook("afterColumnResize",function(t,o,n){return e.onColumnResize(t,o)}),this.addHook("beforeUnmergeCells",function(t,o){return e.onUnmergeCells(t)}),this.addHook("afterSetCellMeta",function(t,o,n,r){return e.onSetMeta(t,o,n,r)}),t.prototype.enablePlugin.call(this)},e.prototype.onAfterFilter=function(t){var e=this,o=this.hot.getPlugin("filters").conditionCollection.exportAllConditions();o.forEach(function(n,r){o[r].column=e.colHeaders[t[r].column]}),this.filters=o;var n={sort:this.sort,filters:this.filters};this.http.post("/data",n).then(function(t){e.loadData(t)})},e.prototype.move=function(t,e,o){if(o===e)return t;for(var n=t[e],r=o<e?-1:1,i=e;i!==o;i+=r)t[i]=t[i+r];return t[o]=n,t},e.prototype.onAfterColumnMove=function(t,e){var o=this,n=[],r=0;for(r=0;r<t.length;r++)n.push(this.colHeaders[t[r]]);var i={columnNames:n,target:e};this.http.post("/column/move",i).then(function(t){o.colHeaders=t.data})},e.prototype.onAfterCreateCol=function(t,e,o){var n=this,r={index:t,amount:e,source:o},i=0===t?1:0;this.http.put("/column",r).then(function(e){for(var o=n.hot.getData().length,r=0;r<o;r++)n.hotInstance.setCellMeta(r,t,"row_id",n.hotInstance.getCellMeta(r,i).row_id),n.hotInstance.setCellMeta(r,t,"col_id",e.name)})},e.prototype.onRemoveCol=function(t,e){return i(this,void 0,void 0,function(){var o,n,r;return s(this,function(i){switch(i.label){case 0:for(o=[],n=0;n<e;n++)o.push(this.colHeaders[n+t]);i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.http.delete("/column",o)];case 2:return i.sent().data?[4,this.http.post("/data")]:[3,4];case 3:return r=i.sent(),this.loadData(r),[2,!0];case 4:return[3,6];case 5:return i.sent(),[2,!1];case 6:return[2,!1]}})})},e.prototype.onAfterCreateRow=function(t,e,o){var n=this,r={index:t,amount:e,source:o};this.http.put("/row",r).then(function(e){for(var o=n.hot.getData()[t],r=1===t?2:1,i=0;i<o.length;i++){var s=n.hot.getCellMeta(r,i).col_id;n.hotInstance.setCellMeta(t,i,"row_id",e.id),n.hotInstance.setCellMeta(t,i,"col_id",s),n.hotInstance.setDataAtCell(t,i,e.data[s])}})},e.prototype.onColumnResize=function(t,e){var o={column:this.hot.getCellMeta(1,t).col_id,size:e};this.http.post("/column/resize",o)},e.prototype.onRemoveRow=function(t,e){for(var o=[],n=0;n<e;n++)o.push(this.hotInstance.getCellMeta(n+t,1).row_id);this.http.delete("/row",o).then(function(t){return!!t})},e.prototype.onRowMove=function(t,e){for(var o=[],n=0;n<t.length;n++)o.push(this.hotInstance.getCellMeta(t[n],1).row_id);var r={rowsMoved:o,target:e};this.http.post("/row/move",r)},e.prototype.onRowResize=function(t,e){var o={row:this.hot.getCellMeta(t,1).row_id,size:e};this.http.post("/row/resize",o)},e.prototype.onAfterColumnSort=function(t,e){var o=this;this.sort=void 0!==e?{column:this.colHeaders[t],order:!0===e?"ASC":"DESC"}:{};var n={sort:this.sort,filters:this.filters};this.http.post("/data",n).then(function(t){o.loadData(t)})},e.prototype.onMergeCell=function(t,e){for(var o={column:this.hot.getCellMeta(e.row,e.col).col_id,row:this.hot.getCellMeta(e.row,e.col).row_id},n=[],r=this._normalizeRange(t),i=r.from.row;i<=r.to.row;i++)for(var s=r.from.col;s<=r.to.col;s++)n.push({column:this.hot.getCellMeta(i,s).col_id,row:this.hot.getCellMeta(i,s).row_id});this.http.post("/cell/merge",{mergedParent:o,mergedCells:n})},e.prototype._normalizeRange=function(t){var e,o;return t.from.row<t.to.row?(e=t.from,o=t.to):t.from.row>t.to.row?(e=t.to,o=t.from):t.from.row===t.to.row&&(t.from.col>t.to.col?(e=t.to,o=t.from):(e=t.from,o=t.to)),{from:e,to:o}},e.prototype.onUnmergeCells=function(t){for(var e={column:this.hot.getCellMeta(t.highlight.row,t.highlight.col).col_id,row:this.hot.getCellMeta(t.highlight.row,t.highlight.col).row_id},o=[],n=t.from.row;n<=t.to.row;n++)for(var r=t.from.col;r<=t.to.col;r++)o.push({column:this.hot.getCellMeta(n,r).col_id,row:this.hot.getCellMeta(n,r).row_id});this.http.post("/cell/unmerge",{mergedParent:e,mergedCells:o})},e.prototype.loadData=function(t){var e=t.data,o=e.map(function(t){return Object.keys(t).map(function(e){return t[e]})});this.hotInstance.loadData(o);var n=Object.keys(e[0]);this.colHeaders=n;for(var r=0;r<e.length;r++)for(var i=0;i<n.length;i++)this.hotInstance.setCellMeta(r,i,"row_id",e[r][t.rowId]),this.hotInstance.setCellMeta(r,i,"col_id",n[i])},e.prototype.onAfterInit=function(){var t=this;this.http.get("/settings").then(function(e){t.hotInstance.updateSettings(e.data,!1)}),this.http.post("/data",null).then(function(e){t.loadData(e)})},e.prototype.onSetMeta=function(t,e,o,n){if("col_id"!==o&&"row_id"!==o){var r={row:this.hot.getCellMeta(t,e).row_id,column:this.hot.getCellMeta(t,e).col_id,key:o,value:n};this.http.post("/cell/meta",r)}},e.prototype.disablePlugin=function(){t.prototype.disablePlugin.call(this)},e.prototype.updatePlugin=function(){this.disablePlugin(),this.enablePlugin(),t.prototype.updatePlugin.call(this)},e.prototype.onAfterChange=function(t,e){if(t){for(var o=[],n=0;n<t.length;n++){var r=this.hotInstance.getCellMeta(t[n][0],t[n][1]),i={row:r.row_id,column:r.col_id,oldValue:t[n][2],newValue:t[n][3],meta:r};delete i.meta.instance,o.push(i)}this.http.post("/cell",{changes:o,source:e})}},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(l._plugins.Base);e.default=c,l.default.plugins.registerPlugin("DataSourceConnector",c)},function(t,e,o){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(o(2)),i=n(o(3)),s=o(4),a=function(){function t(t){this.controllerUrl=t,this.listeners=[],this.defaultHeaders={}}return t.prototype.addListener=function(t){"function"==typeof t&&this.listeners.push(t)},t.prototype.onDataSend=function(t){this.listeners&&this.listeners.length&&this.listeners.forEach(function(e){setTimeout(function(){e(t)},5)})},t.prototype.delete=function(t,e){var o=this,n=new r.default(this.defaultHeaders);return n.url=this.controllerUrl+t,n.method="DELETE",n.body=JSON.stringify(e),this.request(n).then(function(t){return o.onDataSend(new i.default(n,JSON.parse(t))),JSON.parse(t)})},t.prototype.put=function(t,e){var o=this,n=new r.default(this.defaultHeaders);return n.url=this.controllerUrl+t,n.method="PUT",n.body=JSON.stringify(e),this.request(n).then(function(t){return o.onDataSend(new i.default(n,JSON.parse(t))),JSON.parse(t)})},t.prototype.post=function(t,e){var o=this,n=new r.default(this.defaultHeaders);return n.url=this.controllerUrl+t,n.method="POST",n.body=JSON.stringify(e),this.request(n).then(function(t){return o.onDataSend(new i.default(n,JSON.parse(t))),JSON.parse(t)})},t.prototype.get=function(t){var e=this,o=new r.default(this.defaultHeaders);return o.url=this.controllerUrl+t,this.request(o).then(function(t){return e.onDataSend(new i.default(o,JSON.parse(t))),JSON.parse(t)})},t.prototype.request=function(t){return new s.Promise(function(e,o){var n=new XMLHttpRequest;n.open(t.method||"GET",t.url),t.headers&&Object.keys(t.headers).forEach(function(e){n.setRequestHeader(e,t.headers[e])}),n.onload=function(){n.status>=200&&n.status<300?e(n.response):o(n.statusText)},n.onerror=function(){return o(n.statusText)},n.send(t.body)})},t}();e.default=a},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t){this.body="",this.url="",this.method="GET",this.headers=void 0!==t?t:{"Content-Type":"application/json"},this.body=""}}();e.default=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){this.response=t,this.request=e}}();e.default=n},function(t,e,o){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */var n;n=function(){"use strict";function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=0,n=void 0,r=void 0,i=function(t,e){f[o]=t,f[o+1]=e,2===(o+=2)&&(r?r(d):g())};var s="undefined"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,l="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(d,1)}}var f=new Array(1e3);function d(){for(var t=0;t<o;t+=2){(0,f[t])(f[t+1]),f[t]=void 0,f[t+1]=void 0}o=0}var p,v,y,_,g=void 0;function m(t,e){var o=this,n=new this.constructor(C);void 0===n[b]&&N(n);var r=o._state;if(r){var s=arguments[r-1];i(function(){return E(r,n,s,o._result)})}else x(o,n,t,e);return n}function w(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(C);return k(e,t),e}l?g=function(){return process.nextTick(d)}:u?(v=0,y=new u(d),_=document.createTextNode(""),y.observe(_,{characterData:!0}),g=function(){_.data=v=++v%2}):c?((p=new MessageChannel).port1.onmessage=d,g=function(){return p.port2.postMessage(0)}):g=void 0===s?function(){try{var t=Function("return this")().require("vertx");return void 0!==(n=t.runOnLoop||t.runOnContext)?function(){n(d)}:h()}catch(t){return h()}}():h();var b=Math.random().toString(36).substring(2);function C(){}var S=void 0,M=1,H=2,A={error:null};function O(t){try{return t.then}catch(t){return A.error=t,A}}function P(e,o,n){o.constructor===e.constructor&&n===m&&o.constructor.resolve===w?function(t,e){e._state===M?D(t,e._result):e._state===H?j(t,e._result):x(e,void 0,function(e){return k(t,e)},function(e){return j(t,e)})}(e,o):n===A?(j(e,A.error),A.error=null):void 0===n?D(e,o):t(n)?function(t,e,o){i(function(t){var n=!1,r=function(t,e,o,n){try{t.call(e,o,n)}catch(t){return t}}(o,e,function(o){n||(n=!0,e!==o?k(t,o):D(t,o))},function(e){n||(n=!0,j(t,e))},t._label);!n&&r&&(n=!0,j(t,r))},t)}(e,o,n):D(e,o)}function k(t,e){var o,n;t===e?j(t,new TypeError("You cannot resolve a promise with itself")):(n=typeof(o=e),null===o||"object"!==n&&"function"!==n?D(t,e):P(t,e,O(e)))}function R(t){t._onerror&&t._onerror(t._result),I(t)}function D(t,e){t._state===S&&(t._result=e,t._state=M,0!==t._subscribers.length&&i(I,t))}function j(t,e){t._state===S&&(t._state=H,t._result=e,i(R,t))}function x(t,e,o,n){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+M]=o,r[s+H]=n,0===s&&t._state&&i(I,t)}function I(t){var e=t._subscribers,o=t._state;if(0!==e.length){for(var n=void 0,r=void 0,i=t._result,s=0;s<e.length;s+=3)n=e[s],r=e[s+o],n?E(o,n,r,i):r(i);t._subscribers.length=0}}function E(e,o,n,r){var i=t(n),s=void 0,a=void 0,u=void 0,l=void 0;if(i){if((s=function(t,e){try{return t(e)}catch(t){return A.error=t,A}}(n,r))===A?(l=!0,a=s.error,s.error=null):u=!0,o===s)return void j(o,new TypeError("A promises callback cannot return that same promise."))}else s=r,u=!0;o._state!==S||(i&&u?k(o,s):l?j(o,a):e===M?D(o,s):e===H&&j(o,s))}var T=0;function N(t){t[b]=T++,t._state=void 0,t._result=void 0,t._subscribers=[]}var q=function(){function t(t,o){this._instanceConstructor=t,this.promise=new t(C),this.promise[b]||N(this.promise),e(o)?(this.length=o.length,this._remaining=o.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(o),0===this._remaining&&D(this.promise,this._result))):j(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===S&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var o=this._instanceConstructor,n=o.resolve;if(n===w){var r=O(t);if(r===m&&t._state!==S)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(o===z){var i=new o(C);P(i,t,r),this._willSettleAt(i,e)}else this._willSettleAt(new o(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,o){var n=this.promise;n._state===S&&(this._remaining--,t===H?j(n,o):this._result[e]=o),0===this._remaining&&D(n,this._result)},t.prototype._willSettleAt=function(t,e){var o=this;x(t,void 0,function(t){return o._settledAt(M,e,t)},function(t){return o._settledAt(H,e,t)})},t}();var z=function(){function t(e){this[b]=T++,this._result=this._state=void 0,this._subscribers=[],C!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){k(t,e)},function(e){j(t,e)})}catch(e){j(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this.constructor;return this.then(function(o){return e.resolve(t()).then(function(){return o})},function(o){return e.resolve(t()).then(function(){throw o})})},t}();return z.prototype.then=m,z.all=function(t){return new q(this,t).promise},z.race=function(t){var o=this;return e(t)?new o(function(e,n){for(var r=t.length,i=0;i<r;i++)o.resolve(t[i]).then(e,n)}):new o(function(t,e){return e(new TypeError("You must pass an array to race."))})},z.resolve=w,z.reject=function(t){var e=new this(C);return j(e,t),e},z._setScheduler=function(t){r=t},z._setAsap=function(t){i=t},z._asap=i,z.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var o=null;try{o=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===o&&!e.cast)return}t.Promise=z},z.Promise=z,z},t.exports=n()},function(e,o){e.exports=t}]).default});